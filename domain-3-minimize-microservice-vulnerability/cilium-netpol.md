#### Create 2 Pods for Testing
```sh
kubectl run nginx --image=nginx

kubectl run curl --image=alpine/curl -- sleep 36000
```
#### Verify the connectivity
```sh
kubectl get pods -o wide

kubectl exec -it curl -- sh

curl <NGINX-IP>
```

### Example 1 - Simple Deny Policy
```sh
nano deny.yaml
```
```sh
apiVersion: "cilium.io/v2"
kind: CiliumNetworkPolicy
metadata:
  name: "deny-traffic"
spec:
  endpointSelector: {}
  ingress:
    - {}
  egress:
    - {}
```
```sh
kubectl create -f deny.yaml

kubectl get ciliumnetworkpolicies
```
#### Testing - Simple Deny Policy
```sh
kubectl exec -it curl -- sh

curl <NGINX-IP>

ping google.com
```
```sh
kubectl delete -f deny.yaml
```

### Example 2 - Deny Policy for Specific Pod
```sh
nano deny-pod.yaml
```
```sh
apiVersion: "cilium.io/v2"
kind: CiliumNetworkPolicy
metadata:
  name: "deny-traffic"
spec:
  endpointSelector: 
    matchLabels:
      run: curl
  ingress:
    - {}
  egress:
    - {}
```
```sh
kubectl create -f deny-pod.yaml

kubectl get cnp
```
#### Testing - Policy Number 2
```sh
kubectl exec -it curl -- sh
ping google.com

kubectl exec -it nginx -- sh
curl google.com
```
```sh
kubectl delete -f deny-pod.yaml
```

### Example 3 - Allow Traffic from Curl Pod to Nginx Pod

```sh
nano allow-curl-pod.yaml
```
```sh
apiVersion: "cilium.io/v2"
kind: CiliumNetworkPolicy
metadata:
  name: allow-curl-nginx
spec:
  endpointSelector:
    matchLabels:
      run: nginx
  ingress:
    - fromEndpoints:
        - matchLabels:
            run: curl
```
```sh
kubectl create -f allow-curl-pod.yaml
```
#### Testing - Policy 3 

```sh
kubectl exec -it curl -- sh

curl <Nginx-Pod-IP>

kubectl run random-pod --image=alpine/curl -- sleep 36000

kubectl exec -it random-pod -- sh

curl <Nginx-Pod-IP>
```
```sh
kubectl delete -f allow-curl-pod.yaml
```

### Example 4 - Allow Egress Traffic from Curl Pod only to Nginx Pod
```sh
nano egress-to-nginx.yaml
```
```sh
apiVersion: "cilium.io/v2"
kind: CiliumNetworkPolicy
metadata:
  name: allow-egress-curl-to-nginx
spec:
  endpointSelector:
    matchLabels:
      run: curl
  egress:
  - toEndpoints:
    - matchLabels:
        run: nginx
```
#### Testing - Policy 4 

```sh
kubectl exec -it curl -- sh

curl <Nginx-Pod-IP>

ping 8.8.8.8
```

```sh
kubectl delete -f egress-to-nginx.yaml
```

### Delete the Resources Created in this Practical
```sh
kubectl delete pods --all
```