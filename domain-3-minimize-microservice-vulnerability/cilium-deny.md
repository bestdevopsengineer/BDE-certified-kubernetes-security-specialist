
#### Create 3 Pods for Testing
```sh
kubectl run nginx --image=nginx --labels=app=server

kubectl run random-pod --labels=app=random-pod --image=alpine/curl -- sleep 36000

kubectl run backend-pod --image=alpine/curl -- sleep 36000
```
### 1 - Create ingressDeny Policy

```sh
nano ingressDeny.yaml
```
```sh
apiVersion: "cilium.io/v2"
kind: CiliumNetworkPolicy
metadata:
  name: "deny-ingress"
spec:
  endpointSelector:
    matchLabels:
      app: server
  ingress:
  - fromEntities:
    - all
  ingressDeny:
  - fromEndpoints:
    - matchLabels:
        app: random-pod
```

```sh
kubectl create -f ingressDeny.yaml
```

#### Verification
```sh
kubectl get pods -o wide

kubectl exec -it backend-pod -- sh
curl <NGINX-POD-IP>
ping <NGINX-POD-IP>

kubectl exec -it random-pod -- sh
curl <NGINX-POD-IP>
ping <NGINX-POD-IP>
```
```sh
kubectl delete -f ingressDeny.yaml
```
### 2 - Create egressDeny Policy

```sh
nano egressDeny.yaml
```
```sh
apiVersion: "cilium.io/v2"
kind: CiliumNetworkPolicy
metadata:
  name: "deny-egress"
spec:
  endpointSelector:
    matchLabels:
      app: random-pod
  egress:
  - toEntities:
    - all
  egressDeny:
  - toEndpoints:
    - matchLabels:
        app: server
```

```sh
kubectl create -f egressDeny.yaml
```

#### Verification
```sh
kubectl get pods -o wide

kubectl exec -it random-pod -- sh
curl <NGINX-POD-IP>
ping <NGINX-POD-IP>

curl google.com
ping google.com
```

### Delete the Created Resources

```sh
kubectl delete -f egressDeny.yaml

kubectl delete pod nginx random-pod backend-pod
```
